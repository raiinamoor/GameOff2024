[gd_scene load_steps=17 format=3 uid="uid://c5h4kju0x1ghv"]

[ext_resource type="Script" path="res://main.gd" id="1_jjht5"]
[ext_resource type="Script" path="res://room_manager.gd" id="2_rfi6o"]
[ext_resource type="PackedScene" uid="uid://c2cs55gwxv0gt" path="res://Characters/Mitzie/Room/mitzie_room.tscn" id="2_wj121"]
[ext_resource type="PackedScene" uid="uid://l3mjk0unc7ri" path="res://Characters/Cain/Room/cain_room.tscn" id="3_ok4oh"]
[ext_resource type="PackedScene" uid="uid://basecxo85ojpp" path="res://Pinboard/board_layer.tscn" id="3_s2egt"]
[ext_resource type="Script" path="res://Music/music_manager.gd" id="4_8ma02"]
[ext_resource type="PackedScene" uid="uid://donhn7hrb2wu0" path="res://Characters/Aunt_J/aunt_j_room.tscn" id="4_8nu54"]
[ext_resource type="AudioStream" uid="uid://qj2xd8wcevmf" path="res://Music/A4.wav" id="5_5wwdd"]

[sub_resource type="GDScript" id="GDScript_evtwv"]
script/source = "extends Control


func start_game():
	await %TransitionRect.transition(true)
	visible = false


func quit_game():
	get_tree().quit()
"

[sub_resource type="Gradient" id="Gradient_s446h"]
offsets = PackedFloat32Array(1)
colors = PackedColorArray(0.47788, 0.47788, 0.47788, 1)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_spu00"]
gradient = SubResource("Gradient_s446h")

[sub_resource type="CanvasTexture" id="CanvasTexture_o6xpa"]

[sub_resource type="GDScript" id="GDScript_v5a2l"]
script/source = "extends TextureRect


func transition(fade_in: bool, duration: float):
	visible = true
	var final_val = 1 if fade_in else 0
	var t: Tween = create_tween()
	t.tween_property(%TransitionRect, \"modulate:a\", final_val, duration)
	await t.finished
"

[sub_resource type="GDScript" id="GDScript_l5o3n"]
script/source = "extends Control


# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	Dialogic.signal_event.connect(display_note)


func display_note(arg_str: String):
	if arg_str.contains(\"_get\"):
		var number = arg_str.replace(\"_get\", \"\")
		var note: Button = %BoardLayer.find_child(number).duplicate()
		note.disabled = true
		note.mouse_filter = Control.MOUSE_FILTER_IGNORE
		add_child(note)
		note.position = Vector2(0, 0)
		note.modulate.a = 0
		var t: Tween = create_tween().set_ease(Tween.EASE_OUT).set_trans(Tween.TRANS_QUINT).set_parallel()
		t.tween_property(note, \"modulate:a\", 1, 3)
		t.tween_property(note, \"position:y\", -30 , 3)
		await t.finished
		t = create_tween().set_ease(Tween.EASE_OUT).set_trans(Tween.TRANS_QUINT).set_parallel()
		t.tween_property(note, \"global_position\", %OpenPinboardButton.global_position, 1)
		t.tween_property(note, \"scale\", Vector2(0.1, 0.1), 2)
		await t.finished
		note.queue_free()
"

[sub_resource type="GDScript" id="GDScript_8gsmx"]
script/source = "extends Control


var is_enabled: bool = false


func _unhandled_key_input(event: InputEvent) -> void:
	if event.is_action_pressed(\"pause\"):
		if not visible and is_enabled:
			pause()
		elif is_enabled:
			unpause()


func pause():
	var base_style = %Screen.get_node_or_null(\"DialogicLayout_BaseDialogueStyle\")
	if not base_style == null: 
		base_style.visible = false
	visible = true
	Engine.time_scale = 0


func unpause():
	var base_style = %Screen.get_node_or_null(\"DialogicLayout_BaseDialogueStyle\")
	if not base_style == null: 
		base_style.visible = true
	visible = false
	Engine.time_scale = 1


func return_to_main_menu():
	is_enabled = false
"
[node name="Main" type="Node3D"]
script = ExtResource("1_jjht5")

[node name="RoomManager" type="Node3D" parent="."]
script = ExtResource("2_rfi6o")

[node name="MitzieRoom" parent="RoomManager" instance=ExtResource("2_wj121")]

[node name="CainRoom" parent="RoomManager" instance=ExtResource("3_ok4oh")]
visible = false

[node name="AuntJRoom" parent="RoomManager" instance=ExtResource("4_8nu54")]
visible = false

[node name="BoardLayer" parent="." instance=ExtResource("3_s2egt")]
unique_name_in_owner = true
visible = false

[node name="UILayer" type="CanvasLayer" parent="."]

[node name="Screen" type="Control" parent="UILayer"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="MoveLeftButton" type="Button" parent="UILayer/Screen"]
custom_minimum_size = Vector2(100, 200)
layout_mode = 1
anchors_preset = -1
anchor_left = 0.02
anchor_top = 0.5
anchor_right = 0.02
anchor_bottom = 0.5
offset_top = -100.0
offset_right = 100.0
offset_bottom = 100.0
grow_vertical = 2

[node name="MoveRightButton" type="Button" parent="UILayer/Screen"]
custom_minimum_size = Vector2(100, 200)
layout_mode = 1
anchors_preset = -1
anchor_left = 0.98
anchor_top = 0.5
anchor_right = 0.98
anchor_bottom = 0.5
offset_left = -8.0
offset_top = -4.0
offset_bottom = 4.0
grow_horizontal = 0
grow_vertical = 2

[node name="OpenPinboardButton" type="Button" parent="UILayer/Screen"]
unique_name_in_owner = true
custom_minimum_size = Vector2(80, 80)
layout_mode = 1
anchors_preset = -1
anchor_left = 0.98
anchor_top = 0.05
anchor_right = 0.98
anchor_bottom = 0.05
offset_left = -8.0
offset_bottom = 8.0
grow_horizontal = 0

[node name="MainMenu" type="Control" parent="UILayer/Screen"]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = SubResource("GDScript_evtwv")

[node name="TextureRect" type="TextureRect" parent="UILayer/Screen/MainMenu"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
texture = SubResource("GradientTexture1D_spu00")

[node name="VBoxContainer" type="VBoxContainer" parent="UILayer/Screen/MainMenu"]
layout_mode = 1
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 225.0
offset_top = -502.0
offset_right = 681.0
offset_bottom = -174.0
grow_vertical = 0
theme_override_constants/separation = 32

[node name="StartButton" type="Button" parent="UILayer/Screen/MainMenu/VBoxContainer"]
custom_minimum_size = Vector2(0, 100)
layout_mode = 2
text = "START"

[node name="OptionsButton" type="Button" parent="UILayer/Screen/MainMenu/VBoxContainer"]
custom_minimum_size = Vector2(0, 100)
layout_mode = 2
text = "OPTIONS"

[node name="ExitButton" type="Button" parent="UILayer/Screen/MainMenu/VBoxContainer"]
custom_minimum_size = Vector2(0, 100)
layout_mode = 2
text = "EXIT"

[node name="TransitionRect" type="TextureRect" parent="UILayer/Screen"]
unique_name_in_owner = true
modulate = Color(0, 0, 0, 0)
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
texture = SubResource("CanvasTexture_o6xpa")
script = SubResource("GDScript_v5a2l")

[node name="PauseMenu" type="Control" parent="UILayer/Screen"]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = SubResource("GDScript_8gsmx")

[node name="TextureRect" type="TextureRect" parent="UILayer/Screen/PauseMenu"]
modulate = Color(0, 0, 0, 0.501961)
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
texture = SubResource("CanvasTexture_4y2wq")

[node name="VBoxContainer" type="VBoxContainer" parent="UILayer/Screen/PauseMenu"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -237.0
offset_top = -110.0
offset_right = 237.0
offset_bottom = 110.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/separation = 20

[node name="ContinueButton" type="Button" parent="UILayer/Screen/PauseMenu/VBoxContainer"]
custom_minimum_size = Vector2(0, 100)
layout_mode = 2
size_flags_vertical = 4
text = "CONTINUE"

[node name="ExitButton" type="Button" parent="UILayer/Screen/PauseMenu/VBoxContainer"]
custom_minimum_size = Vector2(0, 100)
layout_mode = 2
text = "MAIN MENU"

[node name="NoteDisplay" type="VBoxContainer" parent="UILayer/Screen"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.793
anchor_top = 0.5
anchor_right = 0.9
anchor_bottom = 0.5
offset_left = -40.0
offset_top = -20.0
offset_bottom = 20.0
grow_horizontal = 0
grow_vertical = 2
script = SubResource("GDScript_l5o3n")

[node name="MusicManager" type="Node" parent="."]
script = ExtResource("4_8ma02")

[node name="MainMenuLayer" type="AudioStreamPlayer" parent="MusicManager"]
stream = ExtResource("5_5wwdd")

[node name="HouseBaseLayer" type="AudioStreamPlayer" parent="MusicManager"]

[connection signal="pressed" from="UILayer/Screen/MoveLeftButton" to="RoomManager" method="move_left"]
[connection signal="pressed" from="UILayer/Screen/MoveRightButton" to="RoomManager" method="move_right"]
[connection signal="pressed" from="UILayer/Screen/MainMenu/VBoxContainer/StartButton" to="UILayer/Screen/MainMenu" method="start_game"]
[connection signal="pressed" from="UILayer/Screen/MainMenu/VBoxContainer/ExitButton" to="UILayer/Screen/MainMenu" method="quit_game"]
[connection signal="pressed" from="UILayer/Screen/PauseMenu/VBoxContainer/ContinueButton" to="UILayer/Screen/PauseMenu" method="unpause"]
